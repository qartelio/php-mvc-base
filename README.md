# PHP MVC Base

Базовый PHP проект с использованием архитектуры MVC.

## Структура проекта

```
php-mvc-base/
├── app/                    # Основная директория приложения
│   ├── Config/            # Конфигурационные файлы
│   ├── Controllers/       # Контроллеры
│   │   ├── Admin/        # Административные контроллеры
│   │   ├── Student/      # Контроллеры для студентов
│   │   ├── AdminController.php
│   │   ├── HomeController.php
│   │   └── StudentController.php
│   ├── Core/             # Ядро фреймворка
│   ├── Database/         # Классы для работы с базой данных
│   ├── Helpers/          # Вспомогательные функции
│   ├── Interfaces/       # Интерфейсы
│   ├── Middleware/       # Промежуточное ПО
│   ├── Models/           # Модели
│   │   ├── Administrator.php
│   │   ├── Attendance.php
│   │   ├── Lesson.php
│   │   ├── LessonPoint.php
│   │   └── Student.php
│   ├── Repositories/     # Репозитории для работы с данными
│   ├── Services/         # Сервисы для бизнес-логики
│   └── Views/            # Представления
├── database/             # Файлы базы данных
├── public/               # Публичная директория
│   └── index.php         # Точка входа в приложение
├── vendor/               # Зависимости Composer
├── .git/                 # Git репозиторий
├── composer.json         # Конфигурация Composer
├── composer.lock         # Зафиксированные версии зависимостей
├── database.sql          # SQL-скрипт базы данных
├── Dockerfile           # Конфигурация Docker
├── docker-compose.yml   # Конфигурация Docker Compose
└── apache.conf          # Конфигурация Apache
```

## Основные компоненты

### Контроллеры
- **HomeController** - Главная страница
- **AdminController** - Управление административной частью
- **StudentController** - Управление студентами
- **Admin/LessonsController** - Управление уроками в административной части
- **Admin/AttendanceController** - Управление посещаемостью и активностью
- **Student/LessonsController** - Управление уроками для студентов

### Модели
- **Administrator** - Модель для работы с администраторами
- **Lesson** - Модель для работы с уроками
- **Student** - Модель для работы с данными студентов
- **Attendance** - Модель для отслеживания посещений и активности на уроках
- **LessonPoint** - Модель для учета баллов за активность

### Дополнительные слои
- **Repositories/** - Слой доступа к данным, реализующий паттерн Repository
- **Services/** - Сервисный слой для бизнес-логики
- **Middleware/** - Промежуточное ПО для обработки запросов
- **Database/** - Классы для работы с базой данных
- **Interfaces/** - Интерфейсы для обеспечения слабой связанности компонентов

## Функциональность

### Система уроков
1. **Управление уроками**
   - Создание и редактирование уроков
   - Назначение спикеров
   - Привязка к группам студентов
   - Добавление Zoom-ссылок для онлайн занятий

2. **Посещение и активность на уроках**
   - Отслеживание посещаемости студентов
   - Автоматическая фиксация времени посещения
   - Система баллов за активность на уроках
   - Управление статусами присутствия (присутствовал/отсутствовал)
   - Начисление и редактирование баллов за активность
   - Современный интерфейс управления посещаемостью
   - Автоматическое перенаправление на Zoom-конференцию

3. **Статусы уроков**
   - Активные уроки (доступные для посещения)
   - Завершенные уроки (прошло более 2 часов)
   - История посещений для каждого студента
   - Детальная информация о посещаемости и активности

### Управление посещаемостью
1. **Интерфейс администратора**
   - Удобный список всех уроков с детальной информацией
   - Быстрое переключение статуса посещаемости
   - Управление баллами за активность через модальное окно
   - Визуальные индикаторы статуса присутствия
   - Группировка информации по урокам с возможностью сворачивания

2. **Система баллов**
   - Начисление баллов за активность на уроках
   - История баллов для каждого студента
   - Возможность редактирования баллов
   - Визуальное отображение баллов с иконками

3. **Аналитика**
   - Отображение статистики посещаемости
   - Учет активности студентов
   - История изменений статусов и баллов

### Безопасность
- **Аутентификация**
  - Отдельная авторизация для студентов и администраторов
  - Middleware для проверки прав доступа
  - Защита маршрутов от неавторизованного доступа

- **Валидация данных**
  - Проверка входных данных
  - Безопасная работа с базой данных через PDO
  - Защита от SQL-инъекций
  - Валидация данных при обновлении статусов и баллов

## Развертывание

Проект использует Docker для упрощения развертывания:
- `docker-compose.yml` - конфигурация сервисов (PHP, MySQL, phpMyAdmin)
- `Dockerfile` - сборка PHP-окружения
- `apache.conf` - настройка веб-сервера

### Запуск проекта
1. Клонировать репозиторий
2. Выполнить `docker-compose up -d`
3. Импортировать структуру базы данных из `database/migrations/`
4. Приложение будет доступно по адресу `http://localhost:8085`
5. phpMyAdmin доступен по адресу `http://localhost:8086`

## База данных

### Основные таблицы
- `administrators` - Администраторы системы
- `students` - Студенты
- `lessons` - Уроки
- `attendance` - Посещения уроков
- `lesson_points` - Баллы за активность на уроках

### Таблицы для учета посещаемости
- `attendance`
  - `id` - Уникальный идентификатор
  - `lesson_id` - ID урока
  - `student_id` - ID студента
  - `visited_at` - Время посещения
  - `created_at` - Время создания записи

- `lesson_points`
  - `id` - Уникальный идентификатор
  - `lesson_id` - ID урока
  - `student_id` - ID студента
  - `points` - Количество баллов
  - `created_at` - Время начисления баллов
  - `updated_at` - Время последнего обновления

Структура базы данных находится в файлах миграций в директории `database/migrations/`
